// utils/messages.wxs

var getSeverityText = function(level) {
  var levelMap = {
    'critical': '严重',
    'high': '高',
    'medium': '中',
    'low': '低',
    'info': '信息'
  };
  return levelMap[level] || '信息';
}

var getSeverityColor = function(level) {
  var colorMap = {
    'critical': '#d32f2f',
    'high': '#f57c00',
    'medium': '#ffb300',
    'low': '#689f38',
    'info': '#1976d2'
  };
  return colorMap[level] || '#757575';
}

var formatTimestamp = function(timestamp) {
  if (!timestamp || timestamp === 0) {
    return '未知时间';
  }

  // 检查时间戳格式，可能是秒或毫秒
  var date;
  if (timestamp > 1000000000000) {
    // 毫秒时间戳
    date = getDate(timestamp);
  } else {
    // 秒时间戳
    date = getDate(timestamp * 1000);
  }

  // 检查日期是否有效
  if (isNaN(date.getTime())) {
    return '时间格式错误';
  }

  var now = getDate();
  var diffMs = now - date;
  var diffMins = Math.floor(diffMs / 60000);
  var diffHours = Math.floor(diffMs / 3600000);
  var diffDays = Math.floor(diffMs / 86400000);

  if (diffMins < 1) {
    return '刚刚';
  } else if (diffMins < 60) {
    return diffMins + '分钟前';
  } else if (diffHours < 24) {
    return diffHours + '小时前';
  } else if (diffDays < 7) {
    return diffDays + '天前';
  } else {
    return date.getFullYear() + '/' +
           (date.getMonth() + 1) + '/' +
           date.getDate() + ' ' +
           date.getHours() + ':' +
           (date.getMinutes() < 10 ? '0' : '') + date.getMinutes();
  }
}

module.exports = {
  getSeverityText: getSeverityText,
  getSeverityColor: getSeverityColor,
  formatTimestamp: formatTimestamp
}
